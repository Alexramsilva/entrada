# -*- coding: utf-8 -*-
"""entrada.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/11KD1ncGLRkttekYMq-ZwU_1SDS08aZ_c
"""

# =====================================================
# HOOKE MODEL ‚Äì SCREENER DE ENTRY PR√ìXIMO (STREAMLIT)
# =====================================================

import streamlit as st
import yfinance as yf
import pandas as pd
import numpy as np

# -----------------------------------------------------
# CONFIGURACI√ìN
# -----------------------------------------------------
st.set_page_config(page_title="Hooke Entry Proximity Screener", layout="wide")

TICKERS = [
    "BTC-USD", "GAPB.MX", "PLTR", "SPY", "GRUMAB.MX",
    "FMTY14.MX", "IAU", "HOOD", "SOFI", "NVDA",
    "WALMEX.MX", "FUNO11.MX", "CHDRAUIB.MX",
    "QUBT", "FRES.MX", "JPM", "MCHI", "INDA"
]

st.title("üîÆ Acciones Pr√≥ximas al Signal de Entry (Modelo Hooke)")

# -----------------------------------------------------
# FUNCI√ìN DE AN√ÅLISIS
# -----------------------------------------------------
@st.cache_data(show_spinner=False)
def entry_proximity(ticker):
    try:
        df = yf.download(ticker, period="2y", interval="1d", progress=False)
        if df.empty:
            return None

        # Medias m√≥viles
        df["MA5"] = df["Close"].rolling(5).mean()
        df["MA10"] = df["Close"].rolling(10).mean()
        df.dropna(inplace=True)

        # Condici√≥n de tendencia
        trend_ok = df["MA5"].iloc[-1] < df["MA10"].iloc[-1]

        # Modelo Hooke
        df["x"] = df["Close"] - df["MA10"]
        threshold = df["x"].std() * 1.5

        x_last = df["x"].iloc[-1]
        dist_to_entry = abs(abs(x_last) - threshold)

        return {
            "Ticker": ticker,
            "Precio actual": round(df["Close"].iloc[-1], 2),
            "|x| actual": round(abs(x_last), 4),
            "Umbral": round(threshold, 4),
            "Distancia al Entry": round(dist_to_entry, 4),
            "Tendencia OK": trend_ok
        }

    except Exception:
        return None

# -----------------------------------------------------
# EJECUCI√ìN DEL SCREENER
# -----------------------------------------------------
st.subheader("üìä Ranking de proximidad al Entry")

results = []

with st.spinner("Evaluando activos..."):
    for t in TICKERS:
        r = entry_proximity(t)
        if r:
            results.append(r)

df_screen = pd.DataFrame(results)

# -----------------------------------------------------
# FILTRADO Y ORDENAMIENTO
# -----------------------------------------------------
if not df_screen.empty:
    # Solo los que cumplen condici√≥n de tendencia
    df_screen = df_screen[df_screen["Tendencia OK"]]

    # Ordenar por proximidad al entry
    df_screen = df_screen.sort_values("Distancia al Entry")

    st.dataframe(df_screen, use_container_width=True)

    st.caption("Menor distancia ‚áí m√°s cerca de generar signal de entry")

else:
    st.warning("No se encontraron activos pr√≥ximos al entry.")